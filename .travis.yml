language: python
dist: xenial
python:
- '3.7'
env:
  global:
  - MONGO_URL=mongodb://nebula:nebula@127.0.0.1:27017/nebula?authSource=admin
  - DOCKER_HUB_ORG=nebulaorchestrator
  - DOCKER_HUB_REPO=manager
  - GITHUB_PROJECT=manager
  - secure: I9/SoRRodn/UwDS3J09o+kSlZyGAUF+3Ek8GhDO1+UxXTeE1/E0dUgJi3rJD98V+1+L4PYnBq6WxpHENFDkZMvuS09pKKeZOaG+eaiF+Il2iRcRHLk2QlBCcAHbjCuJlH4+zDPk+lE+gjdWpc3yH6qg7XyxELzNvvLjnxUCD+jMUkaEdTGXH94GTAfHps1RDn+YeNiZrut6V82PoLTIT6NBzaqN1ZF4Ux+PJY+Cq/Yl0MzChQM8ID9a9nDGJ0sLJe6qjYJQn/kxqDNXMsGxSLfPTaAW+jRWU06pQiCJjGgI2vbYTNBX+KqGZ59fzCGpzHAB1iM+uLaWwnahJKxXyDtwlBQGlMAkfOcY7RmmzSQ5eoFFGtVjSW+aBqtsWuQsM6R5tHPHMCKE0Id2j+bpWgM+QXdLnIcTnvsQCKlsPDKs2ndDF2lgp4stwQP227BlOvd4W/+rrFXnNvkvoZ4vNGXuONR7NuDM0+5XBgUTSDEbLAxOex4HEsdQe9vjQLX46Le7bZSw7F8WT63UlCm9VciniQ37UW+SglobVvT//sa3erx+K810I/MXNbC89qY1Aw+EjrNggHKE3p6DdJqw3o9IWg6bFasIz2or1QnfH81NCDFmbRzh/GlYIk2uHwmR2TJ5WW88XngwQCP3so2IJ67g9gtvTo80SDCW52jEv6OY=
  - secure: iee/jaG8EIbbUyVDlCqwsZ7BQJbeIluHeYJ1MmZSoiDWUSvQgReIx90jIt/80jw3eY20YITNYpZxW0wwfvaJdpHXlaEUjItPcUo+vKV2eTrsOjkfmy+gQCmJxj8p4y+1broVFXVVv7JnAChKIIv9SFPCddbJcQGuQedjqocThicS2HWX6jV00jbh1TsbjuJkg5ypd7Ax02nSPYf2AIPEKneY9ws0VaGXCKnyRjMlq2daA+VozL5oqHDP20IrbiZihKV12t0ZczF75RWeymSAd21FbPqKONIav1AmDz+wg4T6lm1afPVlYON+/trJattH9DuG4abI2Pj/+rtyI+O3xGYrjxe9YFvvBRyWBqLb6Zg8D4KjvakA/iWeFl7X9G4lc/VJurFJZL6MUCNhBSgYUw7NpnzGU6cpxzj6CMsMPdw5cY+cDELIYW4kz73p8hxOVhOiOYauXuj0Lhshxd00brmExic1ajKI0T18xsKIVp6B9gmrx3K05565c8BnjX8zS8ehfJGQs62lPKAuY9Z7GjlI3wPwm7PGlUsaVgrask3wvK75YA8g7mJxVonT0mlnWDqOQrwf8trNld9XUJRa11fc7jBj6XKpXFJPrH01jCHiIuJRMVZa34RgHSXh79eLMELtXGsV3uY9DrcPzxshfTr+aD4qKBFg67e7GOr2m0k=
  - secure: fB+0jq4e00n1Wk6a8NdE3B/aKG7M8M1bUqzEGzo7BPAtE8fJnUYTZWLJw3I6W6lTdwXrbQyxms6opmuVLRbTwAf9GGYO7EoUDegfONxaP2/0R07K00GRoedF6xt7Fetok0RN/ZCWKoM8OQhjCRbSwTQhU31CWUNnvbSdZDQPn0xO2AqZvVSCcHqCsHnMrfb9xTFHZpmknWXcP2uEBMFwlVuA1gHqLxlYeDET2I7bilvAtrc+cUMn0IODF1wQ37O4pP7huVuwT2PAHBZZDEdbNXFRPUc3hM8oqAj2rf9rhucL7tH88XnBB0Dfi6mCAvSsY/4wWNWc18PKKC26s1zGa9T/FAWrWat5VHxL6UJKI9JGL7Z8OkkNNV/PNRVkm2Z99AgYcWQD7kNyuZ3okVVz7f38hLMCS9hG/8JgGZ/Nr6qQrR8VFuMmF7h7TNB4xFVzVolPcvFVUvdNb+sneVoi2UfC+FXG6PruM9t7c+ggrlR0pjamlMH6+9teUWsYvjtHCim6a+edNEGtxro22FjRbSEAHlPxUJExD2iKzkyM4RwjG6smY5u1NYnx+dHnK0141e25p1engK61ZHAiGXZGwLdAf+bUb4ttb4y5wBWoW4Ar5Wi9hUsfZ2MWj0Qr+2FsJoKcoYwVIr8QeoajMptFVm/pDrGyyb2I3aE6uNdxfx4=
  - secure: I9RnZF6v2/L0UA+mkYMRW6Pt0Ua27PiVUZ/cWI+LLK+viScrMO3aiWfYnLnGUiseIPf/IXiJrXjCKPUfOKLU+YPf5ijYPK6Ix0v+1WtWIr2coVWmJPUnNqKPQFqb1jnYXNJbNKKNbxl3zNL2T77jq/XYrUvL+e+kmLdbYCxilgdIRgLMDOq3u9pV2o36NLnkX0R0AS/daBBNlI0i5vCVtepRjz0W9OWLqoPkeMK7Vf2qHLpjH9ks1aWND1mbsd/IoFgNEKHf+7yM66XAnbtxR+8LWuSqExLdoXriyqiyl3tILSXX50kRySF0d4id9B+QEb/v6D1nEzLND6f3CDkvo8prruTCcRahCpCEwjIxBY2dJ3Y8V73hdPJkhNWOtpUqjbSU5/OkQJ/rgVVlENmhHBPlWkaL3DOLaEA3KZ2OaAst9qwr9SAD109FkcO0eO/RepqWSHgUEN7j8G8+WjBkPtFbbg9Uogc2TaRWNZsV3IWw0YZGDtow4vyrCdtKUhNz2YOyGhNTQ1GZRSbkp8Sq1Wi6LftmQNDvll+iDEb4yh+VYywfYbonfy76HtOkL4nLWGG91lWDDFeuV5239XTWF1C4cQQGQYwzuuW9s2GjZJnvTn+JuH5R0MdvVqwVpbR0qYDOdZCMnhb2nsE7WlfNWICpDNr7mk4F8SUmqdRgk9M=
  - secure: QcT39CnaG7d5Rd+kVLTPVRsvsRt/08qZTP8IVz7sUovKtuSAH2vjhrYWjEMVFG73rlwSp7r7RhLZJcbBKVyy+rsQtQzphACnwa0Q8G5hjZt2mwKv/snWSoyAKOfit6K4nzomIOzXbOnze7oyUI9qOrs/LAUpxkRog/Q5q3WbgT0/87/9rxMJaMEBiQAdDEihgIEzRHix4o8hEEzXdVUzSe5mjZkMtKDDrDGgvf/DQnWH3WKT7OqD/zhCiH0EkCYX5hzYERh8YH+lFGJEaUUhhYfbpO80z3vem29sY+Q6Z++59278BDO9lWeb1jnAgLVqF4Zu49SypL6A9dGW/4tyZKC1uWPrgKGDnn0hCoImCb5arjMZTJMOXG5F4zDaDLDT3U2feZ4lHJB0y4fLN4gblfMjDMShXkTSmeQVY5PT/LiH13eu4+MPJYdnkWyxd4qJilbFWjbPLHjulPHQ+OpJrP7Ex0x3J0ZDHUq8snFPGyfQ+P/7tAUnzxNBXlbD0FqW+bQhjCl/BZIgIjiWEdxpknKWB5SnzSRLDPLUqEwMzleAygw0c3K4wWUKiQ2chp4tLUMOZz7GvobyjmjQHL9tgmfUT+tmV6BBKJzGOHc9zQ/KU2Y/A9iSImDy79h543RJZknszceU4jtcDzcUoNAC81bCx7ClVr6rmlvCUm1w8gM=
install:
- pip install -r requirements.txt
- pip install codecov
script:
- sudo sh test/travis_ci_scripts/travis_ci_build_script.sh
- coverage run -m unittest
deploy:
  on:
    all_branches: true
  provider: script
  script: bash  test/travis_ci_scripts/deploy.sh
after_success:
- codecov
after_deploy:
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" > .git/credentials
- git config --local user.name "${GITHUB_USER}"
- git config --local user.email "${GITHUB_USER_EMAIL}"
- docker run -e GITHUB_USER=nebula-orchestrator -e GITHUB_PROJECT=${GITHUB_PROJECT} -e CHANGELOG_GITHUB_TOKEN=${GH_TOKEN} -v `pwd`:/output naorlivne/github-changelog-generator-dockerized
- git add CHANGELOG.md
- git commit -m '[skip travis] build ${TRAVIS_BUILD_NUMBER} pushed - new version changelog'
- git push origin HEAD:master
